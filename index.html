<!DOCTYPE html>
<html>
    <head>
        <link href="./index.css" rel="stylesheet">
    </head>
    <body>

        <div class="graphContainer">
            <h1 id="title">Epic Bar Chart</h1>
            <div id="tooltip"></div>
        </div>
        <script type="module">
            import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";

            fetch("https://raw.githubusercontent.com/freeCodeCamp/ProjectReferenceData/master/GDP-data.json")
                .then(response =>response.json())
                .then(data=> {
                    const json = data;
                    const dataSet = json["data"];
                    //console.log(Date.parse(dataSet[0][0]));
                    
                    const w = 700;
                    const h = 500;
                    const padding = 80;
                    
                    const xScale = d3.scaleUtc()
                        .domain([d3.min(dataSet, (d)=>new Date(d[0])), d3.max(dataSet, (d)=>new Date(d[0]))])
                        .range([padding, w-padding]);

                    const yScale = d3.scaleLinear()
                        .domain([0, d3.max(dataSet, (d)=>d[1])])
                        .range([h-padding, padding]);

                    const svg = d3.select(".graphContainer")
                        .append("svg")
                        .attr("width", w)
                        .attr("height", h)
                        .attr("class", "mainBox");

                    svg.selectAll("rect")
                        .data(dataSet)
                        .enter()
                        .append("rect")
                        .attr("class", "bar")
                        .attr("x", (d)=> xScale(new Date(d[0])))
                        .attr("y", (d)=> yScale(d[1]))
                        .attr("width", 2)
                        .attr("height", (d)=> h-yScale(d[1])-padding)
                        .attr("data-date", (d)=>d[0])
                        .attr("data-gdp", (d)=>d[1])
                        .on("mouseover",(event, d)=>{
                            //d3.select(event.target).append("g").text("test")
                            //console.log(d3.select("#tooltip").attr("opacity"))
                            const tooltip = d3.select("#tooltip");
                            tooltip.style("opacity", 0.7)
                            const [x, y] = d3.pointer(event)
                            tooltip.style('transform', `translate(${x}px, ${y}px)`)
                            
                        })
                        .on("mouseout", (event, d)=>d3.select("#tooltip").style("opacity", 0))

                    const xAxis = d3.axisBottom(xScale)
                    //    .ticks(dataSet.length, "f");
                        
                    const yAxis = d3.axisLeft(yScale);

                    svg.append("g")
                        .attr("transform", "translate(0," + (h - padding) + ")")
                        .call(xAxis)
                        .attr("id", "x-axis");
                    
                    svg.append("g")
                        .attr("transform", "translate(" + padding + ",0)")
                        .call(yAxis)
                        .attr("id", "y-axis");
            });
        </script>
        <script src="https://cdn.freecodecamp.org/testable-projects-fcc/v1/bundle.js"></script>
    </body>
</html>